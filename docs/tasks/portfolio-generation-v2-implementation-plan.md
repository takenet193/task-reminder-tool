# ポートフォリオ自動生成システム（v2.0）実装計画

## 実装方針

エラーなく実行するため、以下の原則に従います：
1. **段階的実装**: 小さな単位で実装し、各段階で動作確認
2. **依存関係の明確化**: 各モジュールの依存関係を明確に定義
3. **独立テスト可能**: 各モジュールを個別にテストできる構造
4. **エラーハンドリング**: 各段階で適切なエラーハンドリングを実装

## サブタスク分割

### フェーズ1: 基盤モジュール（2-3日）

#### タスク1.1: 設定ファイル読み込みモジュール
- **ファイル**: `scripts/portfolio/config_loader.py`
- **機能**:
  - `.cursor/portfolio_config.json`を読み込む
  - セルマッピング情報を取得
  - バリデーション（必須フィールドチェック）
- **テスト**:
  - 正常な設定ファイルの読み込み
  - 不正な設定ファイルのエラーハンドリング
  - デフォルト値の適用

#### タスク1.2: エクセル操作基盤モジュール（テンプレートコピー・基本書き込み）
- **ファイル**: `scripts/portfolio/excel_writer.py`（新規作成または既存を拡張）
- **機能**:
  - テンプレートファイルのコピー
  - セルへの基本的な書き込み
  - 書式の保持確認
- **テスト**:
  - テンプレートのコピー成功確認
  - セルへの書き込み確認
  - 書式が保持されているか確認

### フェーズ2: ファイル探索モジュール（3-4日）

#### タスク2.1: パターンマッチングによるファイル探索
- **ファイル**: `scripts/portfolio/file_discovery.py`
- **機能**:
  - ファイル名パターンでの探索（README*, ARCHITECTURE*など）
  - ワイルドカード対応
  - 除外パターンの適用
- **テスト**:
  - 各種パターンでのファイル発見
  - 除外パターンの適用確認

#### タスク2.2: ディレクトリ構造の自動認識
- **ファイル**: `scripts/portfolio/file_discovery.py`（拡張）
- **機能**:
  - ドキュメントディレクトリの自動認識
  - ソースコードディレクトリの自動認識
  - メインエントリーポイントの検出
- **テスト**:
  - 異なるプロジェクト構造での動作確認
  - 認識結果の妥当性確認

#### タスク2.3: ファイル重要度評価
- **ファイル**: `scripts/portfolio/file_discovery.py`（拡張）
- **機能**:
  - ファイル名ベースの重要度スコアリング
  - ディレクトリ位置ベースの重要度
  - ファイルサイズベースの重要度
- **テスト**:
  - スコアリングの妥当性確認
  - 優先順位の正しいソート確認

### フェーズ3: コードベース参照モジュール（2-3日）

#### タスク3.1: ファイル読み込みとコンテキスト構築
- **ファイル**: `scripts/portfolio/codebase_reader.py`
- **機能**:
  - ファイルリストを受け取り、順次読み込み
  - コンテキスト情報の構築
  - 読み込みエラーのハンドリング
- **テスト**:
  - 複数ファイルの読み込み
  - 存在しないファイルのエラーハンドリング
  - 大きすぎるファイルの処理

#### タスク3.2: セマンティック検索インターフェース
- **ファイル**: `scripts/portfolio/semantic_search.py`
- **機能**:
  - Cursorのcodebase_searchツールへのインターフェース
  - 検索クエリの生成
  - 検索結果の解析
- **注意**: 実際のセマンティック検索はCursorの機能を使用（このモジュールはインターフェースのみ）

### フェーズ4: 内容生成モジュール（2-3日）

#### タスク4.1: AI統合と内容生成
- **ファイル**: `scripts/portfolio/content_generator.py`
- **機能**:
  - セルの説明（description）の解析
  - コードベースコンテキストとdescriptionから内容生成
  - 文字数制限の適用
- **注意**: AIによる生成はCursorの機能を使用

#### タスク4.2: 変換ルールの適用
- **ファイル**: `scripts/portfolio/content_generator.py`（拡張）
- **機能**:
  - 日付フォーマット変換
  - 文字数制限による要約
  - 技術リストの抽出
- **テスト**:
  - 各種変換ルールの動作確認

### フェーズ5: 統合とメインスクリプト（2-3日）

#### タスク5.1: メインスクリプトの実装
- **ファイル**: `scripts/portfolio/generate_portfolio_v2.py`
- **機能**:
  - コマンドライン引数の処理
  - 各モジュールの統合
  - エラーハンドリングとロギング
- **テスト**:
  - エンドツーエンドのテスト
  - 各種エラーケースの確認

#### タスク5.2: エラーハンドリングの強化
- **ファイル**: 全モジュール
- **機能**:
  - 各段階での適切なエラーメッセージ
  - 部分的な失敗に対する継続処理
  - ログ出力の整備

### フェーズ6: テストとドキュメント（1-2日）

#### タスク6.1: 統合テスト
- **ファイル**: `tests/test_portfolio_generation_v2.py`
- **機能**:
  - 実際のプロジェクトでの動作確認
  - エッジケースのテスト
  - パフォーマンステスト

#### タスク6.2: ドキュメント作成
- **ファイル**: `docs/reports/portfolio-generation-v2.md`
- **内容**:
  - 実装内容のレポート
  - 使用方法の説明
  - トラブルシューティング

## 実装順序と依存関係

```
[フェーズ1: 基盤]
  ├─ タスク1.1: 設定ファイル読み込み
  └─ タスク1.2: エクセル操作基盤
      ↓
[フェーズ2: ファイル探索]
  ├─ タスク2.1: パターンマッチング
  ├─ タスク2.2: ディレクトリ認識
  └─ タスク2.3: 重要度評価
      ↓
[フェーズ3: コードベース参照]
  ├─ タスク3.1: ファイル読み込み
  └─ タスク3.2: セマンティック検索インターフェース
      ↓
[フェーズ4: 内容生成]
  ├─ タスク4.1: AI統合
  └─ タスク4.2: 変換ルール
      ↓
[フェーズ5: 統合]
  ├─ タスク5.1: メインスクリプト
  └─ タスク5.2: エラーハンドリング強化
      ↓
[フェーズ6: テスト・ドキュメント]
  ├─ タスク6.1: 統合テスト
  └─ タスク6.2: ドキュメント
```

## エラー回避のためのチェックポイント

### 各フェーズ終了時の確認事項

1. **フェーズ1終了時**:
   - 設定ファイルが正しく読み込める
   - エクセルテンプレートがコピーできる
   - 基本的なセル書き込みが動作する

2. **フェーズ2終了時**:
   - パターンマッチングでファイルを発見できる
   - 異なるプロジェクト構造に対応できる
   - ファイル重要度が正しく評価される

3. **フェーズ3終了時**:
   - ファイルが正しく読み込める
   - コンテキストが構築できる

4. **フェーズ4終了時**:
   - 内容生成が動作する
   - 文字数制限が適用される

5. **フェーズ5終了時**:
   - エンドツーエンドで動作する
   - エラーが適切に処理される

## 実装の注意点

1. **既存コードとの互換性**: 既存の`scripts/portfolio/`ディレクトリがあるため、既存コードを確認してから実装
2. **設定ファイルの拡張**: 既存の`.cursor/portfolio_config.json`をv2.0仕様に拡張する必要がある
3. **テスト環境**: 実際のエクセルテンプレートファイルが必要
4. **AI統合**: Cursorの機能を使用するため、インターフェースのみ実装し、実際の生成はCursorに委譲

## 推定工数

- フェーズ1: 2-3日
- フェーズ2: 3-4日
- フェーズ3: 2-3日
- フェーズ4: 2-3日
- フェーズ5: 2-3日
- フェーズ6: 1-2日

**合計**: 12-18日（2-3週間）
