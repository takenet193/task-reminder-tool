# レポート: ポートフォリオ自動生成システム

## 実施概要

就労移行支援で使用するポートフォリオを、レポートやGit履歴から自動生成するシステムを構築した。Markdownレポート、Git履歴、plan.json、requirements.txtから情報を抽出し、エクセルテンプレートに自動入力する機能を実装した。手動での記入作業を削減し、一貫性のあるポートフォリオを効率的に生成できるようになった。

## 実装内容

### 1. システムアーキテクチャ

#### モジュール構成
- `excel_writer.py`: エクセル操作モジュール（テンプレート読み込み、セル書き込み、保存）
- `report_parser.py`: レポート解析モジュール（Markdown解析、セクション抽出）
- `git_analyzer.py`: Git履歴解析モジュール（コミット日取得、日付フォーマット）
- `text_generator.py`: 文章生成モジュール（文字数制限対応の要約・抽出）
- `mapper.py`: 情報マッピングモジュール（設定読み込み、データソース抽出、マッピング）
- `generate_portfolio.py`: メインスクリプト（コマンドライン引数処理、各モジュール統合）

#### データフロー
1. コマンドライン引数の解析
2. 設定ファイル（`.cursor/portfolio_config.json`）の読み込み
3. テンプレートファイルの読み込み
4. データソースからの情報抽出（レポート、Git、plan.json、requirements.txt）
5. 情報のマッピングと変換処理
6. エクセルへの書き込み
7. 出力ファイルの保存

### 2. エクセル操作の実装

#### テンプレートの保持
- `openpyxl`ライブラリを使用してテンプレートを読み込み
- 統合セル（マージ範囲）を完全に保持
- フォント、色、罫線、配置などの書式を完全に保持
- 値のみを書き換え、構造と書式はそのまま

#### セルマッピング
- 設定ファイル（`.cursor/portfolio_config.json`）で各セルのマッピングを定義
- 各セルの行数と推定文字数を考慮した文章生成
- 1行セル（約50文字）と6行統合セル（約300文字）に対応

### 3. レポート解析機能

#### Markdown解析
- 正規表現を使用してセクション（見出し）を抽出
- セクション名の柔軟なマッチング（部分一致対応）
- セクションごとの内容を取得

#### 文章生成
- 文字数制限に応じた要約機能
- 最初の段落の抽出機能
- 長文の要約（6行セル用、約300文字）
- 短文の抽出（1行セル用、約50文字）

### 4. Git履歴解析機能

#### コミット情報の取得
- `subprocess`を使用して`git log`コマンドを実行
- 最新のコミット日を取得
- 日付を指定形式（例: "2025年/11月/25日"）に変換
- Gitリポジトリでない場合のエラーハンドリング

### 5. plan.jsonファイルの複数対応

#### ワイルドカード対応
- `*.plan.json`パターンで複数ファイルを自動検出
- 実行時に`--plan`オプションで特定のファイルを指定可能
- 複数のplanファイルがある場合、`items`配列をマージして統合

#### 情報抽出
- `items[].title`からタイトルを取得
- `items[].summary`から目的を取得
- 複数のplanファイルから情報を統合

### 6. requirements.txtからの技術抽出

#### 技術リストの生成
- requirements.txtから主要な技術を抽出
- 開発用ツール（pytest、ruff、black、mypyなど）を除外
- カンマ区切りの技術リストを生成

### 7. コマンドラインインターフェース

#### オプション
- `--report`: レポートファイルのパス（必須）
- `--output`: 出力ファイルのパス（オプション）
- `--output-dir`: 出力ディレクトリ（オプション）
- `--config`: 設定ファイルのパス（オプション）
- `--template`: テンプレートファイルのパス（オプション）
- `--plan`: 使用するplanファイルのパス（オプション、複数指定可能）
- `--verbose`: 詳細なログを出力

## 成果

### 機能の実現
- レポートから情報を抽出してエクセルに自動入力する機能を実装
- Git履歴から開発日付を取得して自動入力する機能を実装
- plan.jsonからタスク情報を取得して自動入力する機能を実装
- requirements.txtから技術リストを抽出して自動入力する機能を実装
- 文字数制限に応じた文章生成機能を実装

### 作業効率の向上
- 手動での記入作業を大幅に削減
- 一貫性のあるポートフォリオを自動生成
- 複数のレポートから複数のポートフォリオを効率的に生成可能

### 拡張性
- 設定ファイルでマッピングルールを柔軟に変更可能
- 新しいデータソースの追加が容易
- モジュール化により保守性が高い

## 効果

### 時間短縮
- ポートフォリオ作成時間を大幅に短縮
- 手動でのコピー&ペースト作業が不要

### 品質向上
- 一貫性のあるポートフォリオを生成
- 文字数制限を考慮した適切な文章生成
- エラーハンドリングにより安全に動作

### 再利用性
- 複数のレポートから複数のポートフォリオを生成可能
- 設定ファイルを変更することで異なるフォーマットにも対応可能

## 工夫点・改善点

### 実装上の工夫
- モジュール化により保守性と再利用性を向上
- エラーハンドリングを適切に実装し、部分的な失敗でも可能な限り処理を継続
- 文字数制限に応じた文章生成により、セルの行数に適した内容を生成
- シート名の部分一致検索により、設定の柔軟性を向上

### 今後の改善点
- AIを使用した文章生成機能の追加（要約・拡張の品質向上）
- より多くのデータソースへの対応（Jira、GitHub Issuesなど）
- テンプレートのバリエーション対応
- バッチ処理機能の追加（複数レポートの一括処理）

## 使用した技術

- Python 3.x
- openpyxl: エクセル操作
- 正規表現: Markdown解析
- subprocess: Gitコマンド実行
- json: 設定ファイル読み込み
